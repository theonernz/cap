<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½æµ‹è¯• - æµ·é¸¥ä¸–ç•Œ v4.1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px;
            color: white;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .test-section h2 {
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .test-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .test-item h3 {
            margin-bottom: 10px;
            color: #87ceeb;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status.success {
            background: #4caf50;
            color: white;
        }
        
        .status.pending {
            background: #ff9800;
            color: white;
        }
        
        .status.info {
            background: #2196f3;
            color: white;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background: #4caf50;
            color: white;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn.secondary {
            background: #2196f3;
        }
        
        .btn.secondary:hover {
            background: #1976d2;
        }
        
        .btn.danger {
            background: #f44336;
        }
        
        .btn.danger:hover {
            background: #da190b;
        }
        
        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            border-left: 4px solid #4caf50;
        }
        
        .warning-box {
            background: rgba(255, 152, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            border-left: 4px solid #ff9800;
        }
        
        #sessionStatus, #languageStatus, #onlineStatus {
            font-size: 1.1rem;
            margin-top: 10px;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 30px;
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            text-decoration: none;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª æµ·é¸¥ä¸–ç•Œ v4.1 åŠŸèƒ½æµ‹è¯•</h1>
        
        <!-- æµ‹è¯•1: ä¼šè¯ç®¡ç† -->
        <div class="test-section">
            <h2>âœ… æµ‹è¯•1: ä¼šè¯ç®¡ç†ï¼ˆ4å°æ—¶è¶…æ—¶ï¼‰</h2>
            
            <div class="test-item">
                <h3>å½“å‰çŠ¶æ€</h3>
                <div id="sessionStatus">æ£€æŸ¥ä¸­...</div>
                <button class="btn" onclick="checkSession()">åˆ·æ–°çŠ¶æ€</button>
                <button class="btn secondary" onclick="simulateActivity()">æ¨¡æ‹Ÿç”¨æˆ·æ´»åŠ¨</button>
                <button class="btn danger" onclick="clearSession()">æ¸…é™¤ä¼šè¯</button>
            </div>
            
            <div class="info-box">
                <strong>æµ‹è¯•æ­¥éª¤ï¼š</strong><br>
                1. å‰å¾€ä¸»é¡µç™»å½•è´¦å·ï¼ˆä¸é€‰"è®°ä½æˆ‘"ï¼‰<br>
                2. å›åˆ°æœ¬é¡µé¢æŸ¥çœ‹ä¼šè¯çŠ¶æ€<br>
                3. ç‚¹å‡»"æ¨¡æ‹Ÿç”¨æˆ·æ´»åŠ¨"éªŒè¯ä¼šè¯åˆ·æ–°<br>
                4. è§‚å¯Ÿæ§åˆ¶å°çš„ä¼šè¯ç›‘æ§æ—¥å¿—
            </div>
            
            <div class="warning-box">
                <strong>âš ï¸ æ³¨æ„ï¼š</strong> ä¼šè¯è¶…æ—¶è®¾ç½®ä¸º4å°æ—¶ï¼Œå‰©ä½™10åˆ†é’Ÿæ—¶ä¼šæ”¶åˆ°è­¦å‘Šæé†’
            </div>
        </div>
        
        <!-- æµ‹è¯•2: åŒè¯­åˆ‡æ¢ -->
        <div class="test-section">
            <h2>âœ… æµ‹è¯•2: åŒè¯­åˆ‡æ¢åŠŸèƒ½</h2>
            
            <div class="test-item">
                <h3>å½“å‰è¯­è¨€</h3>
                <div id="languageStatus">æ£€æŸ¥ä¸­...</div>
                <button class="btn" onclick="testLanguageSwitch()">æµ‹è¯•åˆ‡æ¢</button>
                <button class="btn secondary" onclick="window.open('index.html', '_blank')">æ‰“å¼€ä¸»é¡µæµ‹è¯•</button>
            </div>
            
            <div class="info-box">
                <strong>æµ‹è¯•æ­¥éª¤ï¼š</strong><br>
                1. æ‰“å¼€ä¸»é¡µ <code>index.html</code><br>
                2. ç‚¹å‡»å³ä¸Šè§’ ğŸŒ è¯­è¨€åˆ‡æ¢æŒ‰é’®<br>
                3. éªŒè¯é¡µé¢æ‰€æœ‰æ–‡æœ¬æ˜¯å¦åˆ‡æ¢<br>
                4. åˆ·æ–°é¡µé¢ï¼ŒéªŒè¯è¯­è¨€è®¾ç½®æ˜¯å¦ä¿å­˜<br>
                5. æµ‹è¯•ç™»å½•/æ³¨å†Œå¯¹è¯æ¡†çš„åŒè¯­æ˜¾ç¤º
            </div>
            
            <div class="info-box">
                <strong>âœ… å·²æ”¯æŒåŒè¯­çš„å…ƒç´ ï¼š</strong><br>
                â€¢ å¯¼èˆªæ ï¼ˆç™»å½•ã€æ³¨å†Œã€é€€å‡ºï¼‰<br>
                â€¢ æ¬¢è¿æ¨ªå¹…<br>
                â€¢ æ¸¸æˆå¡ç‰‡<br>
                â€¢ åœ¨çº¿äººæ•°ã€è¯„åˆ†ç­‰æ ‡ç­¾<br>
                â€¢ è®¤è¯å¯¹è¯æ¡†<br>
                â€¢ ç”¨æˆ·ç»Ÿè®¡é¢æ¿
            </div>
        </div>
        
        <!-- æµ‹è¯•3: åœ¨çº¿äººæ•° -->
        <div class="test-section">
            <h2>âœ… æµ‹è¯•3: åœ¨çº¿äººæ•°åŠ¨æ€æ›´æ–°</h2>
            
            <div class="test-item">
                <h3>å½“å‰åœ¨çº¿äººæ•°</h3>
                <div id="onlineStatus">æ£€æŸ¥ä¸­...</div>
                <button class="btn" onclick="checkOnlineCount()">åˆ·æ–°äººæ•°</button>
                <button class="btn secondary" onclick="testServerAPI()">æµ‹è¯•æœåŠ¡å™¨API</button>
            </div>
            
            <div class="info-box">
                <strong>æµ‹è¯•æ­¥éª¤ï¼š</strong><br>
                1. å¯åŠ¨æœåŠ¡å™¨ï¼š<code>node server/index.js</code><br>
                2. æ‰“å¼€ä¸»é¡µï¼ŒæŸ¥çœ‹æ¸¸æˆå¡ç‰‡çš„åœ¨çº¿äººæ•°<br>
                3. å¤šå¼€å‡ ä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µ<br>
                4. è§‚å¯Ÿåœ¨çº¿äººæ•°æ˜¯å¦å¢åŠ ï¼ˆ30ç§’è‡ªåŠ¨æ›´æ–°ï¼‰<br>
                5. å…³é—­æœåŠ¡å™¨ï¼ŒéªŒè¯é™çº§åˆ°æ¨¡æ‹Ÿæ•°æ®
            </div>
            
            <div class="warning-box">
                <strong>âš ï¸ æ³¨æ„ï¼š</strong> 
                å¦‚æœæœåŠ¡å™¨æœªè¿è¡Œï¼Œä¼šæ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®ï¼ˆ80-150ä¹‹é—´éšæœºå€¼ï¼‰
            </div>
        </div>
        
        <!-- æµ‹è¯•4: StandaloneæŒ‰é’® -->
        <div class="test-section">
            <h2>âœ… æµ‹è¯•4: StandaloneæŒ‰é’®ç§»é™¤</h2>
            
            <div class="test-item">
                <h3>éªŒè¯ç»“æœ <span class="status success">âœ“ å·²å®Œæˆ</span></h3>
                <p>åŸ"Standalone"æŒ‰é’®å·²ä»ä¸»é¡µç§»é™¤ï¼Œæ›¿æ¢ä¸ºè¯­è¨€åˆ‡æ¢æŒ‰é’®ã€‚</p>
                <button class="btn secondary" onclick="window.open('index.html', '_blank')">æ‰“å¼€ä¸»é¡µéªŒè¯</button>
            </div>
            
            <div class="info-box">
                <strong>éªŒè¯æ–¹æ³•ï¼š</strong><br>
                æ‰“å¼€ä¸»é¡µï¼Œç¡®è®¤é¡¶éƒ¨å¯¼èˆªæ å³ä¾§åªæœ‰ï¼š<br>
                â€¢ ğŸŒ è¯­è¨€åˆ‡æ¢æŒ‰é’®<br>
                â€¢ ğŸ”“ ç™»å½•æŒ‰é’®<br>
                â€¢ âœ¨ æ³¨å†ŒæŒ‰é’®
            </div>
        </div>
        
        <!-- å¿«é€Ÿé“¾æ¥ -->
        <div style="text-align: center;">
            <a href="index.html" class="back-link">ğŸ  è¿”å›ä¸»é¡µ</a>
            <a href="FEATURES_UPDATE_v4.1.md" class="back-link" target="_blank">ğŸ“„ æŸ¥çœ‹æ›´æ–°æ–‡æ¡£</a>
        </div>
    </div>
    
    <script>
        // æ£€æŸ¥ä¼šè¯çŠ¶æ€
        function checkSession() {
            const sessionData = localStorage.getItem('seagullWorld_currentSession');
            const statusDiv = document.getElementById('sessionStatus');
            
            if (sessionData) {
                const session = JSON.parse(sessionData);
                const now = Date.now();
                const timeLeft = session.expiresAt - now;
                const hoursLeft = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutesLeft = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                
                statusDiv.innerHTML = `
                    <span class="status success">âœ“ å·²ç™»å½•</span><br>
                    ç”¨æˆ·å: <code>${session.username}</code><br>
                    æ˜¾ç¤ºå: <code>${session.displayName}</code><br>
                    å‰©ä½™æ—¶é—´: <strong>${hoursLeft}å°æ—¶ ${minutesLeft}åˆ†é’Ÿ</strong><br>
                    åˆ›å»ºæ—¶é—´: ${new Date(session.createdAt).toLocaleString()}<br>
                    è¿‡æœŸæ—¶é—´: ${new Date(session.expiresAt).toLocaleString()}
                `;
            } else {
                statusDiv.innerHTML = `
                    <span class="status pending">æœªç™»å½•</span><br>
                    è¯·å‰å¾€ä¸»é¡µç™»å½•åå†æµ‹è¯•
                `;
            }
        }
        
        // æ¨¡æ‹Ÿç”¨æˆ·æ´»åŠ¨
        function simulateActivity() {
            const sessionData = localStorage.getItem('seagullWorld_currentSession');
            if (!sessionData) {
                alert('è¯·å…ˆç™»å½•ï¼');
                return;
            }
            
            const session = JSON.parse(sessionData);
            // åˆ·æ–°ä¼šè¯ï¼ˆå»¶é•¿4å°æ—¶ï¼‰
            session.expiresAt = Date.now() + (4 * 60 * 60 * 1000);
            localStorage.setItem('seagullWorld_currentSession', JSON.stringify(session));
            
            alert('âœ… ä¼šè¯å·²åˆ·æ–°ï¼ä¼šè¯æ—¶é—´å»¶é•¿4å°æ—¶ã€‚');
            checkSession();
        }
        
        // æ¸…é™¤ä¼šè¯
        function clearSession() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤å½“å‰ä¼šè¯å—ï¼Ÿ')) {
                localStorage.removeItem('seagullWorld_currentSession');
                alert('âœ… ä¼šè¯å·²æ¸…é™¤ï¼');
                checkSession();
            }
        }
        
        // æ£€æŸ¥è¯­è¨€è®¾ç½®
        function checkLanguage() {
            const lang = localStorage.getItem('seagullWorld_language') || 'zh';
            const statusDiv = document.getElementById('languageStatus');
            
            const langName = lang === 'zh' ? 'ä¸­æ–‡' : 'English';
            statusDiv.innerHTML = `
                <span class="status info">${langName}</span><br>
                å½“å‰è¯­è¨€ä»£ç : <code>${lang}</code>
            `;
        }
        
        // æµ‹è¯•è¯­è¨€åˆ‡æ¢
        function testLanguageSwitch() {
            const lang = localStorage.getItem('seagullWorld_language') || 'zh';
            const newLang = lang === 'zh' ? 'en' : 'zh';
            localStorage.setItem('seagullWorld_language', newLang);
            
            alert(`âœ… è¯­è¨€å·²åˆ‡æ¢åˆ° ${newLang === 'zh' ? 'ä¸­æ–‡' : 'English'}ï¼\nè¯·æ‰“å¼€ä¸»é¡µæŸ¥çœ‹æ•ˆæœã€‚`);
            checkLanguage();
        }
        
        // æ£€æŸ¥åœ¨çº¿äººæ•°
        async function checkOnlineCount() {
            const statusDiv = document.getElementById('onlineStatus');
            statusDiv.innerHTML = 'æ­£åœ¨è·å–...';
            
            try {
                const response = await fetch('/api/stats/online');
                if (response.ok) {
                    const data = await response.json();
                    statusDiv.innerHTML = `
                        <span class="status success">âœ“ æœåŠ¡å™¨åœ¨çº¿</span><br>
                        å½“å‰åœ¨çº¿äººæ•°: <strong>${data.count}</strong><br>
                        æ›´æ–°æ—¶é—´: ${new Date(data.timestamp).toLocaleTimeString()}
                    `;
                } else {
                    throw new Error('APIè¿”å›é”™è¯¯');
                }
            } catch (error) {
                const mockCount = Math.floor(Math.random() * 70) + 80;
                statusDiv.innerHTML = `
                    <span class="status pending">âš ï¸ æœåŠ¡å™¨ç¦»çº¿</span><br>
                    æ¨¡æ‹Ÿåœ¨çº¿äººæ•°: <strong>${mockCount}</strong><br>
                    <small>æç¤º: å¯åŠ¨æœåŠ¡å™¨ä»¥è·å–çœŸå®æ•°æ®</small>
                `;
            }
        }
        
        // æµ‹è¯•æœåŠ¡å™¨API
        async function testServerAPI() {
            try {
                const response = await fetch('/api/stats/online');
                const data = await response.json();
                alert(`âœ… APIæµ‹è¯•æˆåŠŸï¼\n\n${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                alert(`âŒ APIæµ‹è¯•å¤±è´¥ï¼\n\né”™è¯¯: ${error.message}\n\nè¯·ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼š\nnode server/index.js`);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            checkSession();
            checkLanguage();
            checkOnlineCount();
        });
    </script>
</body>
</html>
