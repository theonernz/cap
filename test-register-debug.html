<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>æ³¨å†Œè°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        input, button {
            padding: 8px;
            margin: 5px;
            font-size: 14px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>ğŸ” ç”¨æˆ·æ³¨å†Œè°ƒè¯•å·¥å…·</h1>
    
    <div class="section">
        <h2>1. æ³¨å†Œæ–°ç”¨æˆ·</h2>
        <input type="text" id="username" placeholder="ç”¨æˆ·å" value="phonis1">
        <input type="password" id="password" placeholder="å¯†ç " value="123456">
        <button onclick="registerUser()">æ³¨å†Œ</button>
    </div>

    <div class="section">
        <h2>2. æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·</h2>
        <button onclick="getAllUsers()">è·å–ç”¨æˆ·åˆ—è¡¨</button>
    </div>

    <div class="section">
        <h2>3. æ£€æŸ¥æœåŠ¡å™¨æ–‡ä»¶</h2>
        <button onclick="checkFiles()">æ£€æŸ¥æ–‡ä»¶çŠ¶æ€</button>
    </div>

    <div class="section">
        <h2>æ—¥å¿—è¾“å‡º</h2>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="log" class="log"></div>
    </div>

    <script>
        const serverUrl = window.location.origin;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        async function registerUser() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                log('âŒ è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }

            log(`ğŸ“ å¼€å§‹æ³¨å†Œç”¨æˆ·: ${username}`, 'info');
            
            // åˆ›å»ºç”¨æˆ·æ•°æ®
            const userId = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            const userData = {
                userId: userId,
                username: username,
                passwordHash: password, // ç®€åŒ–æµ‹è¯•ï¼Œå®é™…åº”è¯¥hash
                profile: {
                    displayName: username,
                    avatar: 'ğŸ¦…',
                    bio: '',
                    motto: '',
                    createdAt: Date.now(),
                    lastLogin: Date.now()
                },
                world: {
                    seagullCoins: 100,
                    worldLevel: 1,
                    totalPlayTime: 0,
                    totalGamesPlayed: 0
                },
                games: {},
                achievements: [],
                friends: [],
                preferences: {
                    language: 'zh',
                    theme: 'light'
                }
            };

            log(`ğŸ“¦ ç”¨æˆ·æ•°æ®: ${JSON.stringify(userData, null, 2)}`, 'info');

            try {
                log(`ğŸš€ å‘é€POSTè¯·æ±‚åˆ° ${serverUrl}/api/users/register`, 'info');
                
                const response = await fetch(`${serverUrl}/api/users/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                log(`ğŸ“¥ æ”¶åˆ°å“åº”ï¼ŒçŠ¶æ€ç : ${response.status}`, 'info');

                const result = await response.json();
                log(`ğŸ“„ å“åº”å†…å®¹: ${JSON.stringify(result, null, 2)}`, result.success ? 'success' : 'error');

                if (result.success) {
                    log('âœ… æ³¨å†ŒæˆåŠŸï¼', 'success');
                    // ç­‰å¾…1ç§’åæ£€æŸ¥æ–‡ä»¶
                    setTimeout(() => {
                        log('â° 1ç§’åæ£€æŸ¥æ–‡ä»¶...', 'info');
                        getAllUsers();
                    }, 1000);
                } else {
                    log(`âŒ æ³¨å†Œå¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                log(`âŒ è¯·æ±‚é”™è¯¯: ${error.message}`, 'error');
                console.error(error);
            }
        }

        async function getAllUsers() {
            log('ğŸ“‹ è·å–æ‰€æœ‰ç”¨æˆ·...', 'info');
            
            try {
                const response = await fetch(`${serverUrl}/api/users`);
                const result = await response.json();
                
                log(`ğŸ“„ ç”¨æˆ·åˆ—è¡¨å“åº”: ${JSON.stringify(result, null, 2)}`, 'info');
                
                if (result.success) {
                    const userCount = Object.keys(result.users).length;
                    log(`âœ… æ‰¾åˆ° ${userCount} ä¸ªç”¨æˆ·`, 'success');
                    
                    if (userCount > 0) {
                        Object.keys(result.users).forEach(userId => {
                            const user = result.users[userId];
                            log(`  ğŸ‘¤ ${user.username} (${userId})`, 'success');
                        });
                    } else {
                        log('âš ï¸ users.jsonä¸­æ²¡æœ‰ç”¨æˆ·ï¼', 'error');
                    }
                } else {
                    log(`âŒ è·å–ç”¨æˆ·å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                log(`âŒ è¯·æ±‚é”™è¯¯: ${error.message}`, 'error');
                console.error(error);
            }
        }

        async function checkFiles() {
            log('ğŸ” æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ...', 'info');
            log('â„¹ï¸ ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæ— æ³•ç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿ', 'info');
            log('â„¹ï¸ è¯·åœ¨PowerShellä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š', 'info');
            log('Get-Content C:\\Phonis\\Games\\Seagull\\data\\users.json | ConvertFrom-Json | Select-Object -ExpandProperty users', 'info');
            
            // ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡APIæ£€æŸ¥
            await getAllUsers();
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–ç”¨æˆ·åˆ—è¡¨
        window.addEventListener('load', () => {
            log('ğŸ¯ é¡µé¢åŠ è½½å®Œæˆ', 'info');
            log(`ğŸŒ æœåŠ¡å™¨åœ°å€: ${serverUrl}`, 'info');
            getAllUsers();
        });
    </script>
</body>
</html>
